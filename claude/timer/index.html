<!DOCTYPE html>
<html>
<head>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100vh;
      font-family: Arial, sans-serif;
      transition: background-color 0.5s;
    }
    
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 100;
    }

    .navbar-title {
      font-weight: bold;
      font-size: 20px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: white;
      padding: 24px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: bold;
    }

    .close-button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
    }

    .settings-group {
      margin-bottom: 20px;
    }

    .settings-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .time-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .time-input {
      width: 80px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    .time-input.error {
      border-color: #ef4444;
    }

    .error-message {
      color: #ef4444;
      font-size: 14px;
      margin-top: 4px;
      min-height: 20px;
    }
    
    #container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: white;
    }

    .timer-display {
      font-size: 120px;
      font-weight: bold;
      margin-bottom: 40px;
      font-family: 'Courier New', monospace;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .controls {
      display: flex;
      gap: 20px;
    }

    button {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    #resetBtn {
      background-color: #f44336;
    }

    #resetBtn:hover {
      background-color: #da190b;
    }

    .settings-button {
      background-color: #2196F3;
    }

    .settings-button:hover {
      background-color: #0976d2;
    }

    .save-button {
      background-color: #4CAF50;
      margin-right: 10px;
    }

    .save-button:hover {
      background-color: #45a049;
    }

    .share-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #e5e5e5;
    }

    .share-title {
      font-weight: bold;
      margin-bottom: 12px;
      font-size: 18px;
    }

    .share-url-container {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .share-url-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      background-color: #f5f5f5;
    }

    .copy-button {
      padding: 10px 20px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
    }

    .copy-button:hover {
      background-color: #0976d2;
    }

    .copy-success {
      color: #4CAF50;
      font-size: 14px;
      margin-top: 5px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .copy-success.show {
      opacity: 1;
    }

    /* Background colors */
    #container.green-bg { background-color: #4CAF50; }
    #container.yellow-bg { background-color: #FFEB3B; }
    #container.red-bg { background-color: #f44336; }
    #container.white-bg { background-color: white; }

    .x-mark {
      color: #ff0000;
      font-size: 150px;
      font-weight: bold;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-start;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="navbar-title">Timer</div>
    <button class="settings-button" id="settingsBtn">Settings</button>
  </div>

  <!-- Settings Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Timer Settings</div>
        <button class="close-button" id="closeBtn">&times;</button>
      </div>
      
      <div class="settings-group">
        <label class="settings-label">Green Duration</label>
        <div class="time-input-group">
          <input type="number" id="greenMin" class="time-input" min="0" max="59" value="13">
          <span>min</span>
          <input type="number" id="greenSec" class="time-input" min="0" max="59" value="0">
          <span>sec</span>
        </div>
        <div class="error-message" id="greenError"></div>
      </div>

      <div class="settings-group">
        <label class="settings-label">Yellow Duration</label>
        <div class="time-input-group">
          <input type="number" id="yellowMin" class="time-input" min="0" max="59" value="1">
          <span>min</span>
          <input type="number" id="yellowSec" class="time-input" min="0" max="59" value="30">
          <span>sec</span>
        </div>
        <div class="error-message" id="yellowError"></div>
      </div>

      <div class="settings-group">
        <label class="settings-label">Red Duration</label>
        <div class="time-input-group">
          <input type="number" id="redMin" class="time-input" min="0" max="59" value="0">
          <span>min</span>
          <input type="number" id="redSec" class="time-input" min="0" max="59" value="30">
          <span>sec</span>
        </div>
        <div class="error-message" id="redError"></div>
      </div>

      <div class="modal-buttons">
        <button class="save-button" id="saveBtn">Save Changes</button>
      </div>

      <!-- Share Section -->
      <div class="share-section">
        <div class="share-title">Share Timer Settings</div>
        <div class="share-url-container">
          <input type="text" class="share-url-input" id="shareUrl" readonly>
          <button class="copy-button" id="copyBtn">Copy</button>
        </div>
        <div class="copy-success" id="copySuccess">URL copied to clipboard!</div>
      </div>
    </div>
  </div>

  <!-- Main Timer Container -->
  <div id="container" class="white-bg">
    <div class="timer-display" id="timerDisplay">15:00</div>
    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="resetBtn">Reset</button>
    </div>
  </div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Timer settings (in seconds)
      let settings = {
        greenTime: 780,  // 13:00
        yellowTime: 90,  // 1:30  
        redTime: 30      // 0:30
      };

      let countdown;
      let totalSeconds = 0;
      let endTime = 0;
      let isRunning = false;
      let timeRemainingOnPause = 0; // NEW: To store time when paused

      // DOM elements
      const container = document.getElementById('container');
      const timerDisplay = document.getElementById('timerDisplay');
      const startBtn = document.getElementById('startBtn');
      const resetBtn = document.getElementById('resetBtn');
      const settingsBtn = document.getElementById('settingsBtn');
      const modal = document.getElementById('modal');
      const closeBtn = document.getElementById('closeBtn');
      const saveBtn = document.getElementById('saveBtn');
      const shareUrlInput = document.getElementById('shareUrl');
      const copyBtn = document.getElementById('copyBtn');
      const copySuccess = document.getElementById('copySuccess');

      // Parse URL parameters on page load
      function parseURLParams() {
        const params = new URLSearchParams(window.location.search);
        
        if (params.has('gm') || params.has('gs')) {
          const gm = parseInt(params.get('gm') || '0');
          const gs = parseInt(params.get('gs') || '0');
          settings.greenTime = gm * 60 + gs;
          document.getElementById('greenMin').value = gm;
          document.getElementById('greenSec').value = gs;
        }
        
        if (params.has('ym') || params.has('ys')) {
          const ym = parseInt(params.get('ym') || '0');
          const ys = parseInt(params.get('ys') || '0');
          settings.yellowTime = ym * 60 + ys;
          document.getElementById('yellowMin').value = ym;
          document.getElementById('yellowSec').value = ys;
        }
        
        if (params.has('rm') || params.has('rs')) {
          const rm = parseInt(params.get('rm') || '0');
          const rs = parseInt(params.get('rs') || '0');
          settings.redTime = rm * 60 + rs;
          document.getElementById('redMin').value = rm;
          document.getElementById('redSec').value = rs;
        }
        
        totalSeconds = getTotalTime();
        timerDisplay.textContent = formatTime(totalSeconds);
        container.className = 'white-bg';
      }

      function generateShareURL() {
        const greenMin = document.getElementById('greenMin').value;
        const greenSec = document.getElementById('greenSec').value;
        const yellowMin = document.getElementById('yellowMin').value;
        const yellowSec = document.getElementById('yellowSec').value;
        const redMin = document.getElementById('redMin').value;
        const redSec = document.getElementById('redSec').value;

        const params = new URLSearchParams({
          gm: greenMin,
          gs: greenSec,
          ym: yellowMin,
          ys: yellowSec,
          rm: redMin,
          rs: redSec
        });

        return `${window.location.origin}${window.location.pathname}?${params.toString()}`;
      }

      function updateShareURL() {
        shareUrlInput.value = generateShareURL();
      }

      function updateBrowserURL() {
        const url = generateShareURL();
        window.history.pushState({}, '', url);
      }

      function copyToClipboard() {
        shareUrlInput.select();
        shareUrlInput.setSelectionRange(0, 99999);
        
        navigator.clipboard.writeText(shareUrlInput.value).then(() => {
          copySuccess.classList.add('show');
          setTimeout(() => {
            copySuccess.classList.remove('show');
          }, 2000);
        }).catch(() => {
          document.execCommand('copy');
          copySuccess.classList.add('show');
          setTimeout(() => {
            copySuccess.classList.remove('show');
          }, 2000);
        });
      }

      function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      function getTotalTime() {
        return settings.greenTime + settings.yellowTime + settings.redTime;
      }

      function updateDisplay() {
        timerDisplay.textContent = formatTime(totalSeconds);
        
        const yellowRedTime = settings.yellowTime + settings.redTime;
        
        if (totalSeconds > yellowRedTime) {
          container.className = 'green-bg';
        } else if (totalSeconds > settings.redTime) {
          container.className = 'yellow-bg';
        } else {
          container.className = 'red-bg';
        }
      }

      // MODIFIED: This function now handles Start, Pause, and Resume
      function toggleTimer() {
        if (isRunning) {
          // --- PAUSE LOGIC ---
          isRunning = false;
          clearInterval(countdown);
          timeRemainingOnPause = endTime - Date.now(); // Store remaining ms
          startBtn.textContent = 'Resume';

        } else {
          // --- START / RESUME LOGIC ---
          isRunning = true;
          startBtn.textContent = 'Pause';
          
          // If we have paused time, we are resuming. Otherwise, we start from the beginning.
          const duration = timeRemainingOnPause > 0 ? timeRemainingOnPause : totalSeconds * 1000;
          
          endTime = Date.now() + duration;

          // Immediately update the display when starting/resuming
          updateDisplay();
          
          countdown = setInterval(() => {
            const remainingMs = endTime - Date.now();

            if (remainingMs <= 0) {
              clearInterval(countdown);
              isRunning = false;
              timeRemainingOnPause = 0; // Clear pause state
              timerDisplay.innerHTML = '<span class="x-mark">X</span>';
              container.className = 'white-bg';
              startBtn.textContent = 'Start';
              startBtn.disabled = false;
              return;
            }

            totalSeconds = Math.round(remainingMs / 1000);
            updateDisplay();
          }, 250);

          timeRemainingOnPause = 0; // Clear the stored paused time
        }
      }
      
      // MODIFIED: Reset function now also clears the pause state
      function reset() {
        clearInterval(countdown);
        totalSeconds = getTotalTime();
        isRunning = false;
        timeRemainingOnPause = 0; // Clear pause state
        timerDisplay.innerHTML = '';
        timerDisplay.textContent = formatTime(totalSeconds);
        container.className = 'white-bg';
        startBtn.textContent = 'Start';
        startBtn.disabled = false;
      }

      function showModal() {
        modal.style.display = 'flex';
        updateShareURL();
      }

      function hideModal() {
        modal.style.display = 'none';
      }

      function validateInput(minInput, secInput, errorElement) {
        const min = parseInt(minInput.value) || 0;
        const sec = parseInt(secInput.value) || 0;
        
        let isValid = true;
        let errorMessage = '';

        if (min < 0 || min > 59) {
          errorMessage = 'Minutes must be between 0 and 59';
          isValid = false;
        } else if (sec < 0 || sec > 59) {
          errorMessage = 'Seconds must be between 0 and 59';
          isValid = false;
        } else if (min === 0 && sec === 0) {
          errorMessage = 'Duration must be at least 1 second';
          isValid = false;
        }

        errorElement.textContent = errorMessage;
        minInput.classList.toggle('error', !isValid);
        secInput.classList.toggle('error', !isValid);
        
        return isValid;
      }

      function validateAllInputs() {
        const greenValid = validateInput(
          document.getElementById('greenMin'),
          document.getElementById('greenSec'),
          document.getElementById('greenError')
        );
        
        const yellowValid = validateInput(
          document.getElementById('yellowMin'),
          document.getElementById('yellowSec'),
          document.getElementById('yellowError')
        );
        
        const redValid = validateInput(
          document.getElementById('redMin'),
          document.getElementById('redSec'),
          document.getElementById('redError')
        );
        
        return greenValid && yellowValid && redValid;
      }

      function saveSettings() {
        if (validateAllInputs()) {
          const inputs = {
            green: [document.getElementById('greenMin'), document.getElementById('greenSec')],
            yellow: [document.getElementById('yellowMin'), document.getElementById('yellowSec')],
            red: [document.getElementById('redMin'), document.getElementById('redSec')]
          };

          settings.greenTime = parseInt(inputs.green[0].value) * 60 + parseInt(inputs.green[1].value);
          settings.yellowTime = parseInt(inputs.yellow[0].value) * 60 + parseInt(inputs.yellow[1].value);
          settings.redTime = parseInt(inputs.red[0].value) * 60 + parseInt(inputs.red[1].value);

          updateBrowserURL();
          hideModal();
          reset();
        }
      }

      document.querySelectorAll('.time-input').forEach(input => {
        input.addEventListener('input', () => {
          validateAllInputs();
          updateShareURL();
        });
      });

      startBtn.addEventListener('click', toggleTimer); // MODIFIED: Button now calls toggleTimer
      resetBtn.addEventListener('click', reset);
      settingsBtn.addEventListener('click', showModal);
      closeBtn.addEventListener('click', hideModal);
      saveBtn.addEventListener('click', saveSettings);
      copyBtn.addEventListener('click', copyToClipboard);

      modal.addEventListener('click', (e) => {
        if (e.target === modal) hideModal();
      });

      document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('keydown', (e) => {
          if (e.key === '-' || e.key === 'e') {
            e.preventDefault();
          }
        });
      });

      // Initialize the application
      parseURLParams();
    });
  </script>


    
</body>
</html>
